## Todo
- [ ] Movies recommendation using ML + Model Compression (quantization, prune, distillation?)
    - [ ] Using cache_resource when loading model
    - Use content-based filtering by computing similarity between movies.
    - [ ] Use recent watched genres to recommend movies with waiting status
    - [ ] Dimension reduction if it slow (SVD, PCA)
    - [ ] Using `recommend` for recommendation in CLI? or in web app? or .ipynb?
        - [ ] Accept movie id to get the "More like this" recommendation
        - [ ] accept genres by -g + Knowledge-based recsys, also consider other options like country or type, status always = 'waiting'
    - [ ] Using LLM to create Overview of movie by name, year, country?, to create plot soup?
    - [ ] Sentiment analysis for Note field to extract useful information. Both for Vietnamese and English
        - [ ] Using LLM for Sentiment analysis? does it sensible? (but reduce privacy)
    - [ ] How does adding episodes_count and episode_length affect recsys performance?
    - [ ] TF-IDF -> SBERT (sentence-transformers)?
    - [ ] maybe later on move to hybrid approach, with CF using movielens dataset, with more recent data
    - [ ] Add recent adding for Recommandation page/recommend command, maybe using 5 latest rows, this partly show user interests at current time
        - [ ] Also using recent watched data + rating, very good information for recsys
    - [ ] Does it really necessary to implement sequence aware recsys? or it considered overengineered?
    - [ ] How about LLM + recsys?
- [ ] Calling LLM API for smart summarize like: total watched time,... using name and year field
  - [ ] As a chatbot interface?
- [ ] Add another table for watched movies in the past (long time ago) but don't remember the date exactly. Maybe just contains: id, name, year, country.
- [ ] Add epsisode, length columns (or as a table) for more metadata, more fun to data-analysis like: total watched time, total watched time for a genre...
- [ ] Make all completed/dropped movie without watched date be marked as 'Past'/'In the past'? does it reasonable to do that?

### CLI
- [ ] CLI demo as GIF and put it in README
- [ ] genres subcommand, contain: list (list all genres with id), delete genre, update/edit genres, clean genres (unused genres like 'test', but maybe now this is unecessary because of ON DELETE CASCADE)
- [ ] Allow `resolve_choice` to handle same initials, when the data scaled (more countries, etc.)
- [ ] Allow adding new country for `add` and `update` command
    - [ ] showing countries (5+) option when adding/updating is cluttered, bad UX -> hide it instead: show_default = False 
        - [ ] Or hide it when the total length exceed a specific threshold?
    - [ ] Add confirmation when adding new country
- [ ] `info` command to call Gemini API to summarize movie info: description, ratings, casts...
    - [ ] Implement llm.py in utils, lazy loading genai lib?
- [ ] Extend `recent` command, make it have some other option like country, type, status,...
- [ ] Auto hide empty column in print_rows, not just filter command have it, sql can have it too
- [ ] `range` command to filter movie by id in range, or maybe add this to filter command
- [ ] Add constants for default limit of `recent` and `latest` command in utils/constants?
- [ ] Add constants for updating the csv file or not in utils/constants
    - [ ] `csv` command to update csv file separately, instead of doing it after CRUD operations, faster UX?
- [ ] Run CLI by using shorter name like `mm ...` (movie-manager) instead of `py cli.py ...` (using uv?)

### Web App
- [ ] Add input validation for Add and Edit pages
    - [ ] Year, date, rating validation 
- [ ] Genres edit/delete page
- [ ] Add Hide note/Show note column checkbox for Data page

### Dashboard
- [ ] Allow it to use sqlite database instead of csv -> faster CLI experience
    - [ ] Then add `csv` to update the csv file for quick overview, remove `update_csv` in CLI app
- [ ] Handle countries distribution pie chart: only show top 4 countries with largest number of movies, others will be labeled as "Other" (include None)

## Done
- [x] Optimize performance by using cache
- [x] change status to dropped or completed auto add date to watched date
- [x] CLI interface with `click`
- [x] Add `restore` command to restore from backup
- [x] Prevent display all movies in CLI: when run with only flags, for example `py cli filter --stats`, it will display all movies -> bad CLI UX
- [x] Allow CLI run SQL scripts? like `py cli.py sql <script>` for quickly query (`py cli.py sql thismonth` list all watched movie in this month, `py cli.py sql watched` list all completed and dropped movie, faster, more flexible, more user customizable, scripts will placed in `sql/` folder)
    - [x] If no script given, print all scripts (exclude `schema.sql`)
- [x] Edit/Update movie functionality for CLI
- [x] Switch to SQLite
    - [x] CRUD operation
    - [x] Backup/Restore mechanism
    - [x] Fix SQLite compatibility with None value
    - [x] Using sql for `stats` command, avoid reading full data compare to current method (read csv using pandas)
    - [x] Add show id checkbox for web ui in Filtering page
- [x] Change web app Edit page layout, add Refresh button
- [x] Add fuzzy matching with genre filtering if there is no match for genre name in the CLI
- [x] Add `--sort` flag for `sql` command
    - [x] Allow inputting asc and desc and its alias for order (default is asc)
- [x] Fuzzy match for sql file for `sql` command
- [x] `--csv` option for `backup` command, for writing data to data/backup.csv with the default backup behavior, offer safer recovery
- [x] For sql command, develop another print_df function but not import and using pandas when there is no filtering like sort or show note, better performance: `print_rows`
- [x] Searches name + note in one command: `search`
- [x] Using SQL instead of pandas filtering in `filter` command
- [x] Move hard-coded type, statuses, and countries to `utils/constants.py`
- [x] Display number of rows for current database file and backup file for backup command
- [x] Alias commands (prefix match + fuzzy matching), better and faster UX, less to type
- [x] Add testing for csv_to_sqlite and CRUD operations on database logic, using pytest, `:memory:` for testing with sqlite
- [x] Add `-l/--latest` flag or option for update/delete operations for operating on the latest movie id
- [x] Create small jupyter notebook for quick visualization compare to power bi dashboard
- [x] Add Visualization page
- [x] SQL page for web app, select script, show dataframe
    - [x] Show SQL code in file, using st.code(query, language='sql')
- [x] Back up & restore functionality for web app, with confirmation dialog
    - [x] Show last modified backup date
    - [x] Show toast when complete
- [x] Add Visualization and SQL page for web app
- [x] Add logging functionalities for CRUD (db related, backup restore...) in CLI
    - [x] Update csv_to_sqlite to prevent logging
- [x] Allow user to write and run SQL code directly, instead of just select SQL filename


## Abandoned
- Color for dataframe using pandas Styler -> Pandas Styler does not compatible with streamlit dataframe, keep it simple
- Data versioning (like DVC) -> overkill for small data, even it has advantage when develop recommender system later on
- Show all movies in CLI -> Bad UX, especially with `--note` flag
- CLI autocompletion -> too complicated, source: https://click.palletsprojects.com/en/stable/shell-completion/
- ORM -> for SQL educational purpose, also less dependency, less bug
- Pydantic integration? -> overkill, more dependency, complexity, runtime overhead
    - Pydanticâ€™s power shines when you have lots of input sources frequent validation
    - streamlit and click already provide simple validation method, so no need for pydantic
- Add toggle in sidebar for: Widgets only show values available in the currently filtered dataset -> Too much to handle, and default filtering feel more natural
- Better (short) year filtering in CLI -> not long-term compatible, what will happen if the year 2100s come? this is hard to handle
    - ```# mask &= ((df['year'] == year) | (df['year'] % 1000 == year)) # handles short year like 25 for 2025```
- Using SQL instead of pandas filtering for `--stats` flag in `filter` command  -> Too complex in query handle and building, harder to maintain -> Use bare Python (Counter) to handle it
- Make `sql` command compatible with filters: `py cli.py sql korea -g romance` -> Too much to handle, but may consider sorting flag instead of filters
- @st.cache_resource for sqlite database connection -> sqlite is not thread-safe, and streamlit is multi-threaded
- Use fzf for genres filtering in CL -> more dependency, also CLI is used for quick filtering, for better UX, go to web app
- Filtering using SQL for Data page -> using pandas does not significant slower than filtering using SQL, and often faster than SQL
- Add simple filtering mechanism for Edit page -> Ctrl + F is enough
- Add `--group` option for filter command, in rich.Table add line to separate it using add_section() -> hard to implement, complex and harder to maintaino
- Enable operator filtering, like filter --year >=8 or something like that
- Paging -> A personal movies collection hardly exceed 10K movies, and Paging method only shine when dealing with database contains million of rows. Also, it's all about UI/UX
- Implement auto copy old value for current field in `update` command -> this is bad in term of security, also user can select and ctrl + C, a bit of work but improve maintainance, reduce code complexity
- pomodoro utils to keep track watched time of this week -> too much friction, inaccurate
- Allow to type id for update/delete command if not provided -> redundant, let click handle it
- Running all the tests by using `check` command in CLI -> No UX benefit, use uv run pytest instead
- Testing for CLI commands -> Not necessary, make it harder to maintain
- Add logging for web app -> Harder to maintain
- Add .dbml (Database Markup Language) file -> Why doesn't have sqlite conversion :), so many limitations